<html>

<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Vendor CSS -->
    <link rel="stylesheet" href="vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/css/owl.carousel.min.css">
    <link rel="stylesheet" href="vendor/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="vendor/css/font-awesome.min.css">
    <!-- CSS Make By Dev -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
	<div id="body-overlay" onclick="closeNav()"></div>
    <div class="header-bg" style="background-color:  #0D5331;">
        <div class="header-sub-bg container-fluid">
            <img src="image/1608191935280-1200x.jpg" alt="" class="img-fluid">
        </div>
    </div>
    <div class="store-brand ">
        <div class="container">
            <div class="row">
                <div class="col-5 col-md-2 mt-2 logo-ddx">
                    <a class="navbar-branch" href="#">
                        <img class="img-fluid" src="image/didongxanh-logo1.png">
                    </a>
                </div>
                <div class="col-2 col-md-1 px-0 mt-2 loca">
                    <select class="form-select form-select-lg localtion-store text-white"
                        aria-label="Default select example">
                        <option selected value="1">Đà Nẵng</option>
                        <option value="2">Hồ Chí Minh</option>
                    </select>
                </div>
                <div class="col-md-5 mt-2 ">
                    <div class="form-group has-search">
                        <span class="fa fa-search form-control-feedback"></span>
                        <input type="text" class="form-control" placeholder="     Bạn cần đang cần tìm gì.....?">
                    </div>
                </div>
                <div class="col-md-3 mt-2 contact-info">
                    <div class="row">
                        <div class="col-md-6 px-0">
                            <div class="hotline">
                                <p><span>HOTLINE</span> <br> 0901 176 222</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="htcuahang">
                                <p>HỆ THỐNG<br> CỬA HÀNG</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-1 col-md-1 mt-2 pl-0 ">
                    <div class="giohang">
                        <button type="button" class="btn btn-link"><i class="fa fa-shopping-cart"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="store-brand-mobi">
        <div class="container">
            <div class="row">
                <div class="col-2 col-md-1 mt-2">
                    <span style="font-size:30px;cursor:pointer;color:#0D5331" onclick="openNav()">&#9776;</span>
                </div>  
                <div class="col-3 col-md-2 px-0 mt-2 loca">
                    <select class="form-select form-select-lg localtion-store text-white"
                        aria-label="Default select example">
                        <option selected value="1">Đà Nẵng</option>
                        <option value="2">Hồ Chí Minh</option>
                    </select>
                </div>
                <div class="col-5 col-md-7 mt-2">
                    <a class="navbar-branch" href="#">
                        <img class="img-fluid" src="image/didongxanh-logo1.png">
                    </a>
                </div>
                <div class="col-2 col-md-2 mt-2 pl-0 ">
                    <div class="giohang">
                        <button type="button" class="btn btn-link"><i class="fa fa-shopping-cart"></i></button>
                    </div>
                </div>
                <div class="col-md-12 mt-2 ">
                    <div class="form-group has-search">
                        <span class="fa fa-search form-control-feedback"></span>
                        <input type="text" class="form-control" placeholder="     Bạn cần đang cần tìm gì.....?">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-menu">
        <nav class="navbar navbar-expand-md navbar-light bg-light sticky-top">
            <div class="container">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#"><img src="image/Group-1.png" alt=""> IPHONE</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><img src="image/Group.png" alt=""> SAMSUNG</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><img src="image/Group-2.png" alt=""> MACBOOK</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="#"><img src="image/Group-28.png" alt=""> APPLE WATCH</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="#"><img src="image/Group-3.png" alt="">ÂM THANH</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="#"><img src="image/Group-31.png" alt=""> PHỤ KIỆN</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="#"><img src="image/Group-33.png" alt=""> SỮA CHỮA</a>
                        </li>
                        <li class="nav-item hidden-li">
                            <a class="nav-link " href="#"><img src="image/Group-36.png" alt=""> THU CŨ</a>
                        </li>
                        <li class="nav-item hidden-li">
                            <a class="nav-link " href="#"><img src="image/Group-38.png" alt=""> KHUYẾN MÃI</a>
                        </li>
                        <li class="nav-item hidden-li">
                            <a class="nav-link " href="#"><img src="image/Group-40.png" alt=""> TRẢ GÓP</a>
                        </li>
                        <li class="nav-item hidden-li">
                            <a class="nav-link " href="#"><img src="image/Group-42.png" alt=""> CÔNG NGHỆ</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <main>
        <div class="container">
            <div class="row">
                <div id="ex_page">
                    <div class="tg_top">
                        <div class="infoproduct">
                            <a class="linksp">
                                <img width=40 height=40 alt="" src="image/11pro.jpg" />
                            </a>
                            <div>
                                Mua trả góp <a class="prodt_url" href="">Iphone 11 pro max</a>
                            </div>
                            <div>
                                Giá sản phẩm: <strong>35.000.000 ₫</strong>
                            </div>
                        </div>
                        <div class="prodt_search">
                            <p>
                                Mọi thông tin liên quan đến trả góp quý khách có nhu cầu tư vấn hãy đến ngay showroom Di Động Xanh, hoặc liên hệ hotline <a href="tel:+0905668282"> 090.566.82.82 </a> để biết thêm chi tiết.
                            </p>
                        </div>
                    </div>
                    <div class="line_split"></div>
                    <div class="prodt_data_table">
                        <div class="lbl">Chọn số tháng trả góp</div>
                        <div class="lst_month_container">
                            <ul class="listmonths">
                                <li data-month="4" class="actived">
                                    <a>
                                        <b>4 tháng</b>
                                    </a>
                                </li>
                                <li data-month="6">
                                    <a>
                                        <b>6 tháng</b>
                                    </a>
                                </li>
                                <li data-month="7">
                                    <a>
                                        <b>7 tháng</b>
                                    </a>
                                </li>
                                <li data-month="8">
                                    <a>
                                        <b>8 tháng</b>
                                    </a>
                                </li>
                                <li data-month="9">
                                    <a>
                                        <b>9 tháng</b>
                                    </a>
                                </li>
                                <li data-month="10">
                                    <a>
                                        <b>10 tháng</b>
                                    </a>
                                </li>
                                <li data-month="11">
                                    <a>
                                        <b>11 tháng</b>
                                    </a>
                                </li>
                                <li data-month="12">
                                    <a>
                                        <b>12 tháng</b>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="tablecontent">
                            <ul class="table">
                                <li>
                                    <aside>Công ty</aside>
                                    <aside><img src="image/home-credit.png" /></aside>
                                    <aside><img src="image/fe-credit.png" /></aside>
                                    <aside><img src="image/mcredit-logo.png" /></aside>
                                    <!-- <aside class="tindung-title">Tín Dụng</aside> -->
                                </li>
                                <li>
                                    <aside>Giá sản phẩm</aside>
                                    <aside>18.900.000₫</aside>
                                    <aside>18.900.000₫</aside>
                                    <aside>18.900.000₫</aside>
                                    <!-- <aside><?php //echo $product_price ?>₫</aside> -->
                                </li>
                                <li>
                                    <aside>
                                        Trả trước
                                        <div class="trtruoc" id="prepaid">
                                            <select id="prdt-tratruoc">
                                                <option value="0">0% - ₫</option>
                                                <option value="0.1">10% - ₫</option>
                                                <option value="0.2">20% - ₫</option>
                                                <option value="0.3">30% - ₫</option>
                                                <option value="0.4" selected="selected">40% - ₫</option>
<?php get_header(); ?>
<?php
    $root = dirname(dirname(dirname(dirname(__FILE__))));
    if (file_exists($root . '/wp-load.php')) {
        require_once($root . '/wp-load.php');
    } else {
        require_once($root . '/wp-config.php');
    }
?>

<?php
    if (!isset($_GET["id"])) {
        wp_redirect(home_url());
        exit;
    }
    $ID = $_GET["id"];
    $product = wc_get_product($ID);

    if($product == null) {
        wp_redirect(home_url());
        exit;
    }
    $product_price_number = $product->get_price();
    $product_link = get_permalink( $ID );
    $product_name = $product->get_name();
    $product_img_src = wp_get_attachment_image_src( get_post_thumbnail_id( $ID ), 'single-post-thumbnail' );
    $product_price = number_format($product_price_number , 0, ',', '.');
    $ls_fe_credit = 3.37;
    $ls_home_credit = 2.77;
    $ls_m_credit = 2.7;
    //$ls_tindung = 0.6;
    $tt_0 =  number_format($product_price_number * 0 , 0, ',', '.');
    $tt_10 = number_format($product_price_number * 0.1 , 0, ',', '.');
    $tt_20 = number_format($product_price_number * 0.2 , 0, ',', '.');
    $tt_30 = number_format($product_price_number * 0.3 , 0, ',', '.'); 
    $tt_40 = number_format($product_price_number * 0.4 , 0, ',', '.');
    $tt_50 = number_format($product_price_number * 0.5 , 0, ',', '.');
    $tt_60 = number_format($product_price_number * 0.6 , 0, ',', '.'); 
    $tt_70 = number_format($product_price_number * 0.7 , 0, ',', '.');
    $tt_80 = number_format($product_price_number * 0.8 , 0, ',', '.');
    $product_cal = $product_price_number - $product_price_number * 0.4;
    $gop_permonth_fe_cal = round(($product_cal / 4) + ($product_cal * ($ls_fe_credit/100)));
    $gop_permonth_home_cal = round(($product_cal / 4) + ($product_cal *($ls_home_credit/100)));
    $gop_permonth_mcredit_cal = round(($product_cal / 4) + ($product_cal *($ls_m_credit/100)));
    //$gop_permonth_tindung_cal = round(($product_cal / 4) + ($product_cal *($ls_tindung/100)));
    $gop_permonth_fe = number_format($gop_permonth_fe_cal, 0, ',', '.');
    $gop_permonth_home = number_format($gop_permonth_home_cal, 0, ',', '.');
    $gop_permonth_mcredit = number_format($gop_permonth_mcredit_cal, 0, ',', '.');
    //$gop_permonth_tindung = number_format($gop_permonth_tindung_cal, 0, ',', '.');
    $total_pay_fe_cal = ( $product_price_number * 0.4) + ($gop_permonth_fe_cal * 4);
    $total_pay_home_cal = ( $product_price_number * 0.4) + ($gop_permonth_home_cal * 4);
    $total_pay_mcredit_cal = ( $product_price_number * 0.4) + ($gop_permonth_mcredit_cal * 4);
    //$total_pay_tindung_cal = ( $product_price_number * 0.4) + ($gop_permonth_tindung_cal * 4);
    $total_pay_fe = number_format($total_pay_fe_cal, 0, ',', '.');
    $total_pay_home = number_format($total_pay_home_cal, 0, ',', '.');
    $total_pay_mcredit = number_format($total_pay_mcredit_cal, 0, ',', '.');
    //$total_pay_tindung = number_format($total_pay_tindung_cal, 0, ',', '.');
    $lech_pay_fe = number_format($total_pay_fe_cal - $product_price_number);
    $lech_pay_home = number_format($total_pay_home_cal - $product_price_number);
    $lech_pay_mcredit = number_format($total_pay_mcredit_cal - $product_price_number);
    //$lech_pay_tindung = number_format($total_pay_tindung_cal - $product_price_number);
?>
<section id="main-primary">
    <div class="container">
        <div class="row">
            <div id="ex_page">
                <div class="tg_top">
                    <div class="infoproduct">
                        <a class="linksp">
                            <img width=40 height=40 alt="<?php echo $product_name; ?>" src="<?php echo $product_img_src[0]; ?>" />
                        </a>
                        <div>
                            Mua trả góp <a class="prodt_url" href="<?php echo $product_link; ?>"> <?php echo $product_name; ?> </a>
                        </div>
                        <div>
                            Giá sản phẩm: <strong><?php echo $product_price ?>₫</strong>
                        </div>
                    </div>
                    <div class="prodt_search">
                        <p>
                            Mọi thông tin liên quan đến trả góp quý khách có nhu cầu tư vấn hãy đến ngay showroom Di Động Xanh, hoặc liên hệ hotline <a href="tel:+0905668282"> 090.566.82.82 </a> để biết thêm chi tiết.
                        </p>
                    </div>
                </div>
                <div class="line_split"></div>
                <div class="prodt_data_table">
                    <div class="lbl">Chọn số tháng trả góp</div>
                    <div class="lst_month_container">
                        <ul class="listmonths">
                            <li data-month="4" class="actived">
                                <a>
                                    <b>4 tháng</b>
                                </a>
                            </li>
                            <li data-month="6">
                                <a>
                                    <b>6 tháng</b>
                                </a>
                            </li>
                            <li data-month="7">
                                <a>
                                    <b>7 tháng</b>
                                </a>
                            </li>
                            <li data-month="8">
                                <a>
                                    <b>8 tháng</b>
                                </a>
                            </li>
                            <li data-month="9">
                                <a>
                                    <b>9 tháng</b>
                                </a>
                            </li>
                            <li data-month="10">
                                <a>
                                    <b>10 tháng</b>
                                </a>
                            </li>
                            <li data-month="11">
                                <a>
                                    <b>11 tháng</b>
                                </a>
                            </li>
                            <li data-month="12">
                                <a>
                                    <b>12 tháng</b>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="tablecontent">
                        <ul class="table">
                            <li>
                                <aside>Công ty</aside>
                                <aside><img src="<?php echo get_template_directory_uri() ?>/images/home-credit.png" /></aside>
                                <aside><img src="<?php echo get_template_directory_uri() ?>/images/fe-credit.png" /></aside>
                                <aside><img src="<?php echo get_template_directory_uri() ?>/images/mcredit-logo.png" /></aside>
                                <!-- <aside class="tindung-title">Tín Dụng</aside> -->
                            </li>
                            <li>
                                <aside>Giá sản phẩm</aside>
                                <aside><?php echo $product_price ?>₫</aside>
                                <aside><?php echo $product_price ?>₫</aside>
                                <aside><?php echo $product_price ?>₫</aside>
                                <!-- <aside><?php //echo $product_price ?>₫</aside> -->
                            </li>
                            <li>
                                <aside>
                                    Trả trước
                                    <div class="trtruoc" id="prepaid">
                                        <select id="prdt-tratruoc">
                                            <option value="0">0% - <?php echo $tt_0 ?>₫</option>
                                            <option value="0.1">10% - <?php echo $tt_10 ?>₫</option>
                                            <option value="0.2">20% - <?php echo $tt_20 ?>₫</option>
                                            <option value="0.3">30% - <?php echo $tt_30 ?>₫</option>
                                            <option value="0.4" selected="selected">40% - <?php echo $tt_40 ?>₫</option>
                                            <option value="0.5">50% - <?php echo $tt_50 ?>₫</option>
                                            <option value="0.6">60% - <?php echo $tt_60 ?>₫</option>
                                            <option value="0.7">70% - <?php echo $tt_70 ?>₫</option>
                                            <option value="0.8">80% - <?php echo $tt_80 ?>₫</option>
                                        </select> 
                                    </div>
                                </aside>
                                <aside id="value_tt_home"><?php echo $tt_40 ?>₫ (40%)</aside>
                                <aside id="value_tt_fe"><?php echo $tt_40 ?>₫ (40%)</aside>
                                <aside id="value_tt_mcredit"><?php echo $tt_40 ?>₫ (40%)</aside>
                                <!-- <aside id="value_tt_td"><?php echo $tt_40 ?>₫ (40%)</aside> -->
                            </li>
                            <li>
                                <aside>Lãi suất thực</aside>
                                <aside><?php echo $ls_home_credit;?>%</aside>
                                <aside><?php echo $ls_fe_credit;?>%</aside>
                                <aside><?php echo $ls_m_credit;?>%</aside>
                                <!-- <aside><?php echo $ls_tindung;?>%</aside> -->
                            </li>
                            <li>
                                <aside>Giấy tờ cần có</aside>
                                <aside>CMND + Bằng lái xe / Hộ khẩu</aside>
                                <aside> CMND + Bằng lái /Hộ khẩu + Hóa đơn điện</aside>
                                <aside> CMND + Bằng lái /Hộ khẩu + Hóa đơn điện</aside>
                                <!-- <aside> CMND + Bằng lái /Hộ khẩu + Hóa đơn điện</aside> -->
                            </li>
                            <li>
                                <aside>
                                    Góp mỗi tháng
                                </aside>
                                <aside id="ppm-1"><?php echo $gop_permonth_home; ?>₫</aside>
                                <aside id="ppm-2"><?php echo $gop_permonth_fe; ?>₫</aside>
                                <aside id="ppm-3"><?php echo $gop_permonth_mcredit; ?>₫</aside>
                                <!-- <aside id="ppm-4"><?php echo $gop_permonth_tindung; ?>₫</aside> -->
                            </li>
                            <li>
                                <aside>
                                    Tổng tiền phải trả
                                </aside>
                                <aside>
                                    <label id="totalpay-1"><?php echo $total_pay_home; ?>₫</label>
                                </aside>
                                <aside>
                                    <label id="totalpay-2"><?php echo $total_pay_fe; ?>₫</label>
                                </aside>
                                <aside>
                                    <label id="totalpay-3"><?php echo $total_pay_mcredit; ?>₫</label>
                                </aside>
                                <!-- <aside>
                                    <label id="totalpay-4"><?php echo $total_pay_tindung; ?>₫</label>
                                </aside> -->
                            </li>
                            <li>
                                <aside>
                                    Chênh lệch với mua trả thẳng
                                </aside>
                                <aside id="diffprice-1"><?php echo $lech_pay_home; ?>₫</aside>
                                <aside id="diffprice-2"><?php echo $lech_pay_fe; ?>₫</aside>
                                <aside id="diffprice-3"><?php echo $lech_pay_mcredit; ?>₫</aside>
                                <!-- <aside id="diffprice-4"><?php echo $lech_pay_tindung; ?>₫</aside> -->
                            </li>
                            <li>
                                <aside>
                                    Xét duyệt Online
                                </aside>
                                <aside> Chưa hỗ trợ </aside>
                                <aside> Chưa hỗ trợ </aside>
                                <aside> Chưa hỗ trợ <button type="button" class="btn btn-danger dk" data-toggle="modal" data-target="#modalOrderInstalment"> Đăng ký </button></aside> 
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="notemoney">
                    <b>Lưu ý:</b> Bảng tính này chỉ mang tính chất tham khảo. Vui lòng đến trực tiếp showroom để được chỉ dẫn chi tiết hơn
                </div>
            </div>
        </div>
        <?php 
            $content_post = get_post(); 
            $content = $content_post->post_content;
            $content = apply_filters('the_content', $content);
            $content = str_replace(']]>', ']]&gt;', $content);
            if($content != null || $content != "") {
        ?>
        <hr>
        <div class="row">
            <div id="ex_cnews" class="col-md-12">
                <?php echo $content ?>
            </div>
        </div>
        <?php } ?>
    </div>
</section>
<input id="prdt_price" type="hidden" value="<?php echo $product_price_number ?>" />
<input id="prdt_month" type="hidden" value="4"/>
<input id="prdt_percent_home" type="hidden" value="<?php echo $ls_home_credit ?>"/>
<input id="prdt_percent_fe" type="hidden" value="<?php echo $ls_fe_credit ?>"/>
<input id="prdt_percent_mcredit" type="hidden" value="<?php echo $ls_m_credit ?>"/>
<input id="prdt_percent_tindung" type="hidden" value="<?php echo $ls_tindung ?>"/>
<input id="prdt_cashPay" type="hidden" value="<?php echo $product_price_number * 0.4?>"/>
<input id="pc-product_id-js" type="hidden" value="<?php echo $ID ?>" />
<input id="pc-product_name-js" type="hidden" value="<?php echo $product_name ?>" />
<input id="pc-product_price-js" type="hidden" value="<?php echo $product_price_number ?>" />
<div class="modal fade" id="modalOrderInstalment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div>
                    <div class="poq-select-title1">Chọn cửa hàng xét duyệt</div>
                    <select class="form-control" id="pc-store_address-js">
                        <option value="1" selected><?php echo Custom_Manage::$ADDRESS_1 ?></option>
                        <option value="2"><?php echo Custom_Manage::$ADDRESS_2 ?></option>
                        <option value="3"><?php echo Custom_Manage::$ADDRESS_3 ?></option>
                        <option value="4"><?php echo Custom_Manage::$ADDRESS_4 ?></option>
                    </select>
                </div>
                <div>
                    <span class="input-text-wrap">
                        <span class="radio-inline">Danh xưng</span>
                        <label class="radio-inline" style="margin-left: 10px; margin-right:5px;font-weight:500;">
                            <span><input id="pc-user_male-js" type="radio" name="optradio" checked>Anh</span>
                        </label>
                        <label class="radio-inline" style="font-weight:500;">
                            <span><input id="pc-user_female-js" type="radio" name="optradio">Chị</span>
                        </label>
                    </span>
                </div>
                <div>
                    <div class="poq-select-title1">Họ và tên</div>
                    <input type="text" class="form-control" placeholder="Nhập họ và tên" id="pc-user_fullname-js" />
                </div>
                <div class="modal-row-container">
                    <div class="modal-hafl-row"> 
                        <div class="poq-select-title1">Ngày Sinh</div>
                        <input type="text" name="dob" class="form-control" placeholder="01/01/1990" id="pc-dob-js"/>
                    </div>
                    <div class="modal-hafl-row"> 
                        <div class="poq-select-title1">Số điện thoại</div>
                        <input type="text" maxlength="10" class="form-control" placeholder="Nhập số điện thoại" id="pc-user_phone-js" onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')" />
                    </div>
                </div>
                <div style="margin-top: 5px">
                    <div class="poq-select-title1">Email</div>
                    <input type="text" maxlength="50" class="form-control" placeholder="Nhập địa chỉ email" id="pc-user_email-js"/>
                </div>
                <div>
                    <div class="poq-select-title1">Chứng minh nhân dân</div>
                    <input type="text" class="form-control" placeholder="Nhập số CMND" id="pc-number_identity_card-js"/>
                </div>
                <div>
                    <div class="poq-select-title1">Thông tin thêm (giúp xét duyệt dễ hơn)</div>
                    <span class="input-text-wrap">
                        <label class="radio-inline" style="margin-left: 10px; margin-right:5px; font-weight:500;">
                            <span><input id="pc-number_inhabitants_radio-js" type="radio" name="optradio1" checked>Giấy phép lái xe</span>
                        </label>
                        <label class="radio-inline" style="font-weight:500;">
                            <span><input id="pc-number_driver_lisence_radio-js" type="radio" name="optradio1">Số sổ hộ khẩu</span>
                        </label>
                        <input type="text" class="form-control" placeholder="Nhập số sổ hộ khẩu/Giấy phép lái xe" id="pc-value_optional-js"/>
                    </span>
                </div>
                <input type="hidden" id="register_nonce-js" value="<?php echo wp_create_nonce('sp_insert_order_phone') ?>" />
                <input type="hidden" id="product_id-js" value="<?php echo $product->get_id() ?>" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" id="btn-orderInstalment-js" class="btn btn-datlichsuachua">Gửi Duyệt</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title qoq-modal-tittle">Thông Báo !!!</h4>
            </div>
            <div class="modal-body">
                <p id="notification-text-js"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
            </div>
        </div>

    </div>
</div>
<?php get_footer(); ?>

<script>
var URL_UPDATE_API = "/gwzv/themes/clickbuy/custom-api//order-instalment.php";
jQuery( document ).ready(function() {
    changeMonth();
    changePercent();
    regexDOB();

    jQuery("#btn-orderInstalment-js").click(function(){
        orderInstalment();
    });
})

function changeMonth () {
    jQuery(".listmonths li a").click(function(){
        const list = document.querySelectorAll(".listmonths li a");
        for( const item of list){
            if (item == this) {
                jQuery(this).parent().addClass("actived")
                const month = jQuery(this).parent().data("month")
                jQuery("#prdt_month").val(month)
                const cashPay = jQuery("#prdt_cashPay").val()
                calCashPayEachMonth(cashPay)
            }
            else {
                jQuery(item).parent().removeClass("actived")
            }
        }
    })
}

function changePercent() {
    jQuery("#prdt-tratruoc").change(function(){
        const percent = jQuery(this).children("option:selected").val()
        const price =  jQuery("#prdt_price").val()
        const value = (price * percent)
        onChangeCashPay(value, percent * 100)
        jQuery("#prdt_cashPay").val(value)
        calCashPayEachMonth(value)
    })
}

function onChangeCashPay(value, percentValue){
    const formatValue = formatNumber(value) + "₫"
    const valueStr = formatValue + " (" + percentValue + "%)"
    jQuery("#value_tt_home").text(valueStr)
    jQuery("#value_tt_fe").text(valueStr)
    jQuery("#value_tt_mcredit").text(valueStr)
}

function calCashPayEachMonth(valueCashPay){
    const prdt_price = jQuery("#prdt_price").val()
    const month = jQuery("#prdt_month").val()
    const price_pay = prdt_price - valueCashPay
    const lsHome = jQuery("#prdt_percent_home").val()/100
    const lsFE = jQuery("#prdt_percent_fe").val()/100
    const lsMcredit = jQuery("#prdt_percent_mcredit").val()/100
    //const lsTindung = jQuery("#prdt_percent_tindung").val()/100
    const calHome = Math.round((price_pay/month) + (price_pay* lsHome))
    const calFE = Math.round((price_pay/month) + (price_pay* lsFE))
    const calMcredit = Math.round((price_pay/month) + (price_pay* lsMcredit))
    //const calTindung = Math.round((price_pay/month) + (price_pay* lsTindung))
    const valueHome = formatNumber(calHome) + "₫"
    const valueFE = formatNumber(calFE) + "₫"
    const valueMCredit = formatNumber(calMcredit) + "₫"
    //const valueTindung = formatNumber(calTindung) + "₫"
    jQuery("#ppm-1").text(valueHome)
    jQuery("#ppm-2").text(valueFE)
    jQuery("#ppm-3").text(valueMCredit)
    //jQuery("#ppm-4").text(valueTindung)
    totalCashPay(prdt_price, month, prdt_price - price_pay, calHome, calFE, calMcredit)
}

function totalCashPay(prdt_price, month, price_pay, calHome, calFe, calMcredit) {
    const calFE = price_pay + calFe * month
    const calHOME = price_pay + calHome * month
    const calMCREDIT = price_pay + calMcredit * month
    //const calTINDUNG = price_pay + calTindung * month
    const valueHome = formatNumber(calHOME) + "₫"
    const valueFE = formatNumber(calFE) + "₫"
    const valueMCredit = formatNumber(calMCREDIT) + "₫"
    //const valueTindung = formatNumber(calTINDUNG) + "₫"
    jQuery("#totalpay-1").text(valueHome)
    jQuery("#totalpay-2").text(valueFE)
    jQuery("#totalpay-3").text(valueMCredit)
    //jQuery("#totalpay-4").text(valueTindung)
    chenhLech(prdt_price, calFE, calHOME, calMCREDIT)
}

function chenhLech(prdt_price, total_pay_fe, total_pay_home, total_pay_mcredit){
    const valueFE = formatNumber(total_pay_fe - prdt_price) + "₫"
    const valueHome = formatNumber(total_pay_home - prdt_price) + "₫"
    const valueMcredit = formatNumber(total_pay_mcredit - prdt_price) + "₫"
    //const valueTindung = formatNumber(total_pay_tindung - prdt_price) + "₫"
    jQuery("#diffprice-1").text(valueHome)
    jQuery("#diffprice-2").text(valueFE)
    jQuery("#diffprice-3").text(valueMcredit)
    //jQuery("#diffprice-4").text(valueTindung)
}

function formatNumber (n) {
    return n.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.')
}

function regexDOB(){
    var $jqDate = jQuery('input[name="dob"]');

    //Bind keyup/keydown to the input
    $jqDate.bind('keyup','keydown', function(e){
    //To accomdate for backspacing, we detect which key was pressed - if backspace, do nothing:
        if(e.which !== 8) { 
            var numChars = $jqDate.val().length;
            if(numChars === 2 || numChars === 5){
                var thisVal = $jqDate.val();
                thisVal += '/';
                $jqDate.val(thisVal);
            }
        }
    });
}

function orderInstalment(){
    const user_fullname = jQuery('#pc-user_fullname-js').val();
    if (!user_fullname || user_fullname == "") {
        openDialog("Xin vui lòng nhập họ và tên");
        return;
    }

    const user_phone = jQuery('#pc-user_phone-js').val();
    if (!user_phone || user_phone == "") {
        openDialog("Xin vui lòng nhập số điện thoại");
        return;
    }

    const dob = jQuery("#pc-dob-js").val();
    var reg = /^(((0[1-9]|[12]\d|3[01])\/(0[13578]|1[02])\/((19|[2-9]\d)\d{2}))|((0[1-9]|[12]\d|30)\/(0[13456789]|1[012])\/((19|[2-9]\d)\d{2}))|((0[1-9]|1\d|2[0-8])\/02\/((19|[2-9]\d)\d{2}))|(29\/02\/((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))))$/g;
    if(!reg.test(dob)){
        openDialog("Xin vui lòng kiểm tra lại ngày tháng năm sinh");
    }

    const number_identity_card = jQuery("#pc-number_identity_card-js").val();
    if(!number_identity_card || number_identity_card == "") {
        openDialog("Xin vui lòng nhập số CMND");
        return;
    }

    var dateObject = new Date(dob);
    var yearOld = calculate_age(dateObject);
    if(yearOld < 18) {
        openDialog("Tuổi phải lớn hơn 18");
    } else if( yearOld > 70) {
        openDialog("Xin vui lòng kiểm tra lại ngày tháng năm sinh");
    }

    const store_address = jQuery('#pc-store_address-js').val();
    const productName = jQuery("#pc-product_name-js").val();
    const productID = jQuery("#pc-product_id-js").val();
    const user_email = jQuery("#pc-user_email-js").val();
    const productPrice  = jQuery("#pc-product_price-js").val();
    let gender = 0;
    if(jQuery("#pc-user_male-js").is(":checked")) gender = 1;

    let value_number_inhabitants = "";
    if(jQuery("#pc-number_inhabitants_radio-js").is(":checked")) value_number_inhabitants = jQuery("#pc-value_optional-js").val();

    let value_number_driver_lisence = "";
    if(jQuery("#pc-number_driver_lisence_radio-js").is(":checked")) value_number_driver_lisence = jQuery("#pc-value_optional-js").val();

    

    const data = {
        "data": {
            "product_name": productName,
            "product_id": productID,
            "status": 1,
            "dob": dob,
            "user_fullname": user_fullname.toUpperCase(),
            "user_phone": user_phone,
            "user_email": user_email,
            "store_address": store_address,
            "product_price": productPrice,
            "user_gender": gender,
            "number_inhabitants": value_number_inhabitants,
            "number_driver_lisence": value_number_driver_lisence,
            "number_identity_card": number_identity_card,
            "brand_company": "mCredit",
            "insert_nonce": jQuery('#register_nonce-js').val(),
            "action": "register"
        }
    };

    //console.log(data);
    ajaxRegisterOrderInstalment(data);
}

// Call ajax to Insert action
function ajaxRegisterOrderInstalment(data) {
    jQuery.ajax({
        url: URL_UPDATE_API,
        type: "POST",
        cache: false,
        data: data,
        dataType: "json",
        success: function(response) {
            const data = response;
            console.log(response);
            if (data.statusCd == "01") {
                jQuery("#modalOrderInstalment").modal('hide');
                openDialog("Đăng ký thành công.\n Nhân viên chăm sóc sẽ liên hệ xác nhận với bạn sớm nhất.\n Cảm ơn bạn đã tin tưởng ClickBuy.");
                clearData();
            } else if (data.statusCd == "02") {
                openDialog("Nhập thông tin sai vui lòng kiểm tra lại");
            }
        },
        error: function(error) {
            openDialog("Lỗi hệ thống! Xin vui lòng thử lại sai")
            console.log(error);
        }
    });
}

function openDialog(textString) {
    textString = textString.replace(/\n/g, '<br/>');
    jQuery('#notification-text-js').html(textString);
    jQuery("#myModal").modal({ show: true });
}

function calculate_age(dob) { 
    var diff_ms = Date.now() - dob.getTime();
    var age_dt = new Date(diff_ms); 

    return Math.abs(age_dt.getUTCFullYear() - 1970);
}

function clearData(){
    jQuery('#pc-user_fullname-js').val("");
    jQuery('#pc-user_phone-js').val("");
    jQuery("#pc-dob-js").val("");
    jQuery("#pc-number_identity_card-js").val("");
    jQuery("#pc-user_email-js").val("");
}
</script>
<?php
    if (!isset($_GET["id"])) {
        wp_redirect(home_url());
        exit;
    }
    $ID = $_GET["id"];
    $product = wc_get_product($ID);

    if($product == null) {
        wp_redirect(home_url());
        exit;
    }
    $product_price_number = $product->get_price();
    $product_link = get_permalink( $ID );
    $product_name = $product->get_name();
    $product_img_src = wp_get_attachment_image_src( get_post_thumbnail_id( $ID ), 'single-post-thumbnail' );
    $product_price = number_format($product_price_number , 0, ',', '.');
    $ls_fe_credit = 3.37;
    $ls_home_credit = 2.77;
    $ls_m_credit = 2.7;
    //$ls_tindung = 0.6;
    $tt_0 =  number_format($product_price_number * 0 , 0, ',', '.');
    $tt_10 = number_format($product_price_number * 0.1 , 0, ',', '.');
    $tt_20 = number_format($product_price_number * 0.2 , 0, ',', '.');
    $tt_30 = number_format($product_price_number * 0.3 , 0, ',', '.'); 
    $tt_40 = number_format($product_price_number * 0.4 , 0, ',', '.');
    $tt_50 = number_format($product_price_number * 0.5 , 0, ',', '.');
    $tt_60 = number_format($product_price_number * 0.6 , 0, ',', '.'); 
    $tt_70 = number_format($product_price_number * 0.7 , 0, ',', '.');
    $tt_80 = number_format($product_price_number * 0.8 , 0, ',', '.');
    $product_cal = $product_price_number - $product_price_number * 0.4;
    $gop_permonth_fe_cal = round(($product_cal / 4) + ($product_cal * ($ls_fe_credit/100)));
    $gop_permonth_home_cal = round(($product_cal / 4) + ($product_cal *($ls_home_credit/100)));
    $gop_permonth_mcredit_cal = round(($product_cal / 4) + ($product_cal *($ls_m_credit/100)));
    //$gop_permonth_tindung_cal = round(($product_cal / 4) + ($product_cal *($ls_tindung/100)));
    $gop_permonth_fe = number_format($gop_permonth_fe_cal, 0, ',', '.');
    $gop_permonth_home = number_format($gop_permonth_home_cal, 0, ',', '.');
    $gop_permonth_mcredit = number_format($gop_permonth_mcredit_cal, 0, ',', '.');
    //$gop_permonth_tindung = number_format($gop_permonth_tindung_cal, 0, ',', '.');
    $total_pay_fe_cal = ( $product_price_number * 0.4) + ($gop_permonth_fe_cal * 4);
    $total_pay_home_cal = ( $product_price_number * 0.4) + ($gop_permonth_home_cal * 4);
    $total_pay_mcredit_cal = ( $product_price_number * 0.4) + ($gop_permonth_mcredit_cal * 4);
    //$total_pay_tindung_cal = ( $product_price_number * 0.4) + ($gop_permonth_tindung_cal * 4);
    $total_pay_fe = number_format($total_pay_fe_cal, 0, ',', '.');
    $total_pay_home = number_format($total_pay_home_cal, 0, ',', '.');
    $total_pay_mcredit = number_format($total_pay_mcredit_cal, 0, ',', '.');
    //$total_pay_tindung = number_format($total_pay_tindung_cal, 0, ',', '.');
    $lech_pay_fe = number_format($total_pay_fe_cal - $product_price_number);
    $lech_pay_home = number_format($total_pay_home_cal - $product_price_number);
    $lech_pay_mcredit = number_format($total_pay_mcredit_cal - $product_price_number);
    //$lech_pay_tindung = number_format($total_pay_tindung_cal - $product_price_number);
?>
<script>

jQuery( document ).ready(function() {
    changeMonth();
    changePercent();
    regexDOB();

})
function changeMonth () {
    jQuery(".listmonths li a").click(function(){
        const list = document.querySelectorAll(".listmonths li a");
        for( const item of list){
            if (item == this) {
                jQuery(this).parent().addClass("actived")
                const month = jQuery(this).parent().data("month")
                jQuery("#prdt_month").val(month)
                const cashPay = jQuery("#prdt_cashPay").val()
                calCashPayEachMonth(cashPay)
            }
            else {
                jQuery(item).parent().removeClass("actived")
            }
        }
    })
}
function changePercent() {
    jQuery("#prdt-tratruoc").change(function(){
        const percent = jQuery(this).children("option:selected").val()
        const price =  jQuery("#prdt_price").val()
        const value = (price * percent)
        onChangeCashPay(value, percent * 100)
        jQuery("#prdt_cashPay").val(value)
        calCashPayEachMonth(value)
    })
}
function regexDOB(){
    var $jqDate = jQuery('input[name="dob"]');

    //Bind keyup/keydown to the input
    $jqDate.bind('keyup','keydown', function(e){
    //To accomdate for backspacing, we detect which key was pressed - if backspace, do nothing:
        if(e.which !== 8) { 
            var numChars = $jqDate.val().length;
            if(numChars === 2 || numChars === 5){
                var thisVal = $jqDate.val();
                thisVal += '/';
                $jqDate.val(thisVal);
            }
        }
    });
}

</script>
</html>